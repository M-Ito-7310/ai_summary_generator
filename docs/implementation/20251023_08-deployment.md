# Phase 8: Vercelデプロイ＆プレリリース - 詳細実装ガイド

**Phase**: 8/8
**推定時間**: 2時間
**前提条件**: Phase 1-7完了、Vercelアカウント作成済み
**次のステップ**: 本番運用開始

---

## 目次

1. [概要](#概要)
2. [前提条件の確認](#前提条件の確認)
3. [本番ビルドの確認](#本番ビルドの確認)
4. [Vercelプロジェクトセットアップ](#vercelプロジェクトセットアップ)
5. [環境変数の設定](#環境変数の設定)
6. [本番デプロイ](#本番デプロイ)
7. [本番環境動作確認](#本番環境動作確認)
8. [カスタムドメイン設定（オプション）](#カスタムドメイン設定オプション)
9. [監視とロギング](#監視とロギング)
10. [成果物チェックリスト](#成果物チェックリスト)

---

## 概要

Phase 8では、AIパパっと要約 & 感想ジェネレーターをVercelにデプロイし、本番環境で公開します。環境変数の設定、ビルドの確認、本番デプロイ、動作確認を行います。

### このPhaseで実現すること

- ローカルでの本番ビルド確認
- Vercelプロジェクトのセットアップ
- 環境変数の本番環境設定
- 本番デプロイの実行
- 本番環境での動作確認
- カスタムドメインの設定（オプション）
- 監視とロギングの設定

---

## 前提条件の確認

### 必要な準備

#### 1. Vercelアカウント

1. [Vercel](https://vercel.com/)にアクセス
2. GitHubアカウントでサインアップ
3. アカウント作成完了

#### 2. GitHubリポジトリ

**リポジトリが未作成の場合:**

```bash
# Git初期化
git init

# リモートリポジトリ追加
git remote add origin https://github.com/[username]/ai-summary-generator.git

# 初回コミット
git add .
git commit -m "Initial commit"

# プッシュ
git branch -M main
git push -u origin main
```

#### 3. 環境変数の確認

`.env.local`に以下が設定されていることを確認:

```env
# OpenAI API
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Neon PostgreSQL
DATABASE_URL="postgresql://user:password@ep-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require"
DIRECT_URL="postgresql://user:password@ep-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require"
```

---

## 本番ビルドの確認

### ステップ 1: ローカルで本番ビルド

#### 1-1. ビルドの実行

```bash
npm run build
```

**期待される出力:**

```
▲ Next.js 15.x.x
- Environments: .env.local

Creating an optimized production build...
✓ Compiled successfully
✓ Linting and checking validity of types
✓ Collecting page data
✓ Generating static pages (X/X)
✓ Collecting build traces
✓ Finalizing page optimization

Route (app)                              Size     First Load JS
┌ ○ /                                    X kB           XX kB
├ ○ /api/history                         X kB           XX kB
├ ○ /api/summarize                       X kB           XX kB
└ ○ /history                             X kB           XX kB

○  (Static)  prerendered as static content

✓ Build completed successfully
```

#### 1-2. TypeScript型チェック

```bash
npm run type-check
```

**期待される出力:**

```
> tsc --noEmit

No errors found.
```

#### 1-3. ESLintチェック

```bash
npm run lint
```

**期待される出力:**

```
✓ No ESLint warnings or errors
```

### ステップ 2: 本番ビルドのテスト

```bash
npm run start
```

ブラウザで `http://localhost:3000` にアクセスし、本番ビルドが正常に動作することを確認

---

## Vercelプロジェクトセットアップ

### ステップ 3: Vercelプロジェクト作成

#### 方法1: Vercel CLI（推奨）

**Vercel CLIのインストール:**

```bash
npm install -g vercel
```

**Vercelにログイン:**

```bash
vercel login
```

**プロジェクトのセットアップ:**

```bash
vercel
```

**インタラクティブプロンプトへの回答:**

```
? Set up and deploy "~/ai-summary-generator"? [Y/n] y
? Which scope do you want to deploy to? [your-username]
? Link to existing project? [y/N] n
? What's your project's name? ai-summary-generator
? In which directory is your code located? ./
Auto-detected Project Settings (Next.js):
- Build Command: next build
- Development Command: next dev --port $PORT
- Install Command: npm install
- Output Directory: Next.js default
? Want to modify these settings? [y/N] n
```

#### 方法2: Vercel Dashboard

1. [Vercel Dashboard](https://vercel.com/dashboard)にアクセス
2. 「New Project」をクリック
3. GitHubリポジトリを選択
4. プロジェクト名を入力: `ai-summary-generator`
5. Framework Presetを確認: `Next.js`
6. Build Commandを確認: `next build`
7. Output Directoryを確認: `.next`

---

## 環境変数の設定

### ステップ 4: Vercelに環境変数を追加

#### 方法1: Vercel CLI

```bash
# OpenAI API Key
vercel env add OPENAI_API_KEY

# Neon PostgreSQL
vercel env add DATABASE_URL
vercel env add DIRECT_URL
```

プロンプトで以下を選択:
- Environment: Production, Preview, Development（すべて選択）
- Value: 各環境変数の値を入力

#### 方法2: Vercel Dashboard

1. Vercel Dashboardでプロジェクトを開く
2. 「Settings」タブをクリック
3. 「Environment Variables」セクションに移動
4. 以下の環境変数を追加:

| Name | Value | Environments |
|------|-------|--------------|
| `OPENAI_API_KEY` | `sk-proj-xxx...` | Production, Preview, Development |
| `DATABASE_URL` | `postgresql://...` | Production, Preview, Development |
| `DIRECT_URL` | `postgresql://...` | Production, Preview, Development |

**重要:**
- 「Save」をクリックして保存
- すべての環境（Production, Preview, Development）を選択

---

## 本番デプロイ

### ステップ 5: 本番環境へのデプロイ

#### 方法1: Vercel CLI

```bash
# 本番デプロイ
vercel --prod
```

**期待される出力:**

```
🔍  Inspect: https://vercel.com/[username]/ai-summary-generator/[deployment-id]
✅  Production: https://ai-summary-generator.vercel.app [copied to clipboard]
```

#### 方法2: Git Push（自動デプロイ）

```bash
# 変更をコミット
git add .
git commit -m "feat: ready for production"

# mainブランチにプッシュ
git push origin main
```

Vercelが自動的にデプロイを開始します。

#### デプロイ状況の確認

1. Vercel Dashboardでプロジェクトを開く
2. 「Deployments」タブでデプロイ状況を確認
3. ビルドログを確認

**デプロイが成功すると:**
- ✓ Build completed successfully
- ✓ Deployment ready
- 本番URLが発行される

---

## 本番環境動作確認

### ステップ 6: 本番環境での動作テスト

#### 6-1. 基本機能のテスト

**テスト項目:**

- [ ] ホームページが表示される
- [ ] URL入力フォームが動作する
- [ ] 要約生成が動作する（実際の記事URLでテスト）
- [ ] 感想コメント生成が動作する
- [ ] コピー機能が動作する
- [ ] 履歴保存が動作する
- [ ] 履歴取得が動作する
- [ ] 履歴削除が動作する

#### 6-2. API エンドポイントのテスト

**テストコマンド:**

```bash
# 要約生成API
curl -X POST https://ai-summary-generator.vercel.app/api/summarize \
  -H "Content-Type: application/json" \
  -d '{"url":"https://example.com/article"}'

# 履歴取得API
curl https://ai-summary-generator.vercel.app/api/history
```

#### 6-3. データベース接続の確認

**確認方法:**

1. 本番環境で要約を生成
2. Neon Consoleでデータベースを確認
3. `summaries`テーブルにデータが保存されていることを確認

#### 6-4. エラーハンドリングの確認

**テスト項目:**

- [ ] 無効なURLでエラーメッセージが表示される
- [ ] ネットワークエラー時の適切なエラー表示
- [ ] AI APIエラー時の適切なエラー表示

---

## カスタムドメイン設定（オプション）

### ステップ 7: 独自ドメインの設定

#### 7-1. ドメインの追加

**Vercel Dashboardでの設定:**

1. プロジェクトの「Settings」→「Domains」
2. 「Add」ボタンをクリック
3. ドメイン名を入力（例: `ai-summary.com`）
4. 「Add」をクリック

#### 7-2. DNSレコードの設定

**Aレコード（推奨）:**

```
Type: A
Name: @
Value: 76.76.21.21
```

**CNAMEレコード:**

```
Type: CNAME
Name: www
Value: cname.vercel-dns.com
```

#### 7-3. SSL証明書の確認

Vercelが自動的にSSL証明書を発行します。

**確認方法:**
- ドメインにアクセス
- URLバーに🔒マークが表示される
- HTTPSで接続されている

---

## 監視とロギング

### ステップ 8: Vercel Analytics の設定

#### 8-1. Vercel Analytics の有効化

1. Vercel Dashboardでプロジェクトを開く
2. 「Analytics」タブをクリック
3. 「Enable Analytics」をクリック

#### 8-2. 監視項目

**パフォーマンス監視:**
- ページロード時間
- API レスポンスタイム
- Core Web Vitals

**エラー監視:**
- エラーレート
- エラーログ
- スタックトレース

### ステップ 9: ログの確認

#### ログの表示

**Vercel CLI:**

```bash
# リアルタイムログ
vercel logs --follow

# 本番環境のログ
vercel logs --prod
```

**Vercel Dashboard:**
1. プロジェクトの「Functions」タブ
2. 各APIルートのログを確認

---

## デプロイ後のチェックリスト

### 環境確認

- [ ] 本番URLにアクセス可能
- [ ] HTTPSで接続されている
- [ ] すべてのページが表示される
- [ ] API エンドポイントが動作する

### 機能確認

- [ ] URL入力→要約生成が動作
- [ ] 感想コメント生成が動作
- [ ] コピー機能が動作
- [ ] 履歴機能が動作
- [ ] データベースに正しく保存される

### パフォーマンス確認

- [ ] Lighthouse Performance 90以上
- [ ] ページロード時間が2秒以内
- [ ] API レスポンスタイムが5秒以内

### セキュリティ確認

- [ ] 環境変数が正しく設定されている
- [ ] APIキーが露出していない
- [ ] HTTPS接続が有効
- [ ] XSS対策が機能している

### 監視設定

- [ ] Vercel Analytics 有効化
- [ ] エラーログ確認可能
- [ ] パフォーマンス監視設定完了

---

## トラブルシューティング

### よくある問題と解決策

#### 1. ビルドエラー

**症状**: `Build failed`

**解決策:**
```bash
# ローカルでビルド確認
npm run build

# TypeScript エラー確認
npm run type-check

# ログを確認
vercel logs --prod
```

#### 2. 環境変数エラー

**症状**: `Missing environment variables`

**解決策:**
- Vercel Dashboardで環境変数を再確認
- すべての環境（Production, Preview, Development）に設定されているか確認
- 環境変数名のスペルミスを確認

#### 3. データベース接続エラー

**症状**: `Can't reach database server`

**解決策:**
- Neon Consoleでデータベースがアクティブか確認
- `DATABASE_URL`が正しいか確認
- Neon PostgreSQLの無料枠を確認

#### 4. デプロイが反映されない

**症状**: 最新の変更が本番に反映されない

**解決策:**
```bash
# キャッシュをクリア
vercel --prod --force

# または
# Vercel Dashboardで「Redeploy」
```

---

## プレリリースチェックリスト

### リリース前の最終確認

#### ドキュメント

- [ ] README.md 完成
- [ ] APIドキュメント完成
- [ ] 既知の問題をドキュメント化

#### 本番環境

- [ ] 本番URLにアクセス可能
- [ ] すべての機能が動作
- [ ] パフォーマンス基準達成
- [ ] セキュリティチェック完了

#### 監視・運用

- [ ] Analytics 有効化
- [ ] エラーログ確認可能
- [ ] 監視体制整備

#### 広報・共有

- [ ] SNSでの告知準備
- [ ] デモ動画作成（オプション）
- [ ] ランディングページ最終確認

---

## 本番運用開始

### 次のステップ

#### 1. プレリリース告知

**SNSでの告知:**

```
🎉 AIパパっと要約 & 感想ジェネレーター リリース！

記事URLを入力するだけで、
✅ 3行で簡潔に要約
✅ SNS投稿用の感想を3パターン生成

タイパ重視の時代に最適なツールです。
無料で使えます！

https://ai-summary-generator.vercel.app

#AI #要約 #タイパ #生成AI
```

#### 2. フィードバック収集

**収集方法:**
- SNSでのコメント
- GitHub Issues
- Googleフォーム（オプション）

#### 3. 継続的改善

**改善サイクル:**
1. ユーザーフィードバック収集
2. バグ修正・機能改善
3. テスト
4. デプロイ

---

## 成果物チェックリスト

### Phase 8完了の確認

- [ ] ローカル本番ビルド成功
- [ ] Vercel プロジェクト作成完了
- [ ] 環境変数設定完了
- [ ] 本番デプロイ成功
- [ ] 本番環境動作確認完了
- [ ] データベース接続確認完了
- [ ] パフォーマンステスト合格
- [ ] セキュリティチェック完了
- [ ] Analytics 有効化
- [ ] ログ確認可能
- [ ] プレリリースチェックリスト完了

### ドキュメント

- [ ] README.md 完成
- [ ] デプロイ手順ドキュメント完成
- [ ] 運用ガイド作成

---

**🎉 Phase 8完了！AIパパっと要約 & 感想ジェネレーターが本番環境で稼働開始しました！**

**本番URL**: https://ai-summary-generator.vercel.app

次は継続的な改善とユーザーフィードバックに基づく機能拡張に進みます。
