# Phase 03: AI統合

**Status**: 🟢 完了
**Priority**: Critical
**Estimated Time**: 5時間
**Actual Time**: 1.5時間
**Assigned**: AI Agent
**Started**: 2025-10-24
**Completed**: 2025-10-24

---

## 📝 Description

OpenAI APIを統合し、記事の要約と感想コメント生成機能を実装します。

### 目標
- 記事コンテンツ取得機能の実装
- AI要約生成APIエンドポイントの実装
- 感想コメント生成（3パターン）の実装
- エラーハンドリングとレート制限対応

---

## ✅ Checklist

### 記事取得機能
- [ ] URLからHTMLコンテンツを取得する関数実装
- [ ] HTMLパースライブラリの選定・導入
- [ ] メタデータ抽出（タイトル、著者、公開日）
- [ ] 本文抽出ロジックの実装
- [ ] エラーハンドリング（404, タイムアウト等）

### OpenAI API統合
- [ ] OpenAI SDKのセットアップ
- [ ] API認証の実装
- [ ] 環境変数からAPIキーを安全に取得
- [ ] レート制限対応の実装
- [ ] タイムアウト設定

### 要約生成API (src/app/api/summarize/route.ts)
- [ ] POSTエンドポイントの実装
- [ ] リクエストバリデーション
- [ ] プロンプトエンジニアリング（3行要約）
- [ ] OpenAI APIコール実装
- [ ] レスポンス形式の整形
- [ ] エラーレスポンスの統一

### 感想コメント生成
- [ ] 3パターンの感想生成プロンプト設計
- [ ] トーンの違い（カジュアル、フォーマル、専門的）
- [ ] 異なる視点の提供（賛成、中立、批判的）
- [ ] SNS投稿に適した文字数調整（50-150文字）

### プロンプト最適化
- [ ] システムプロンプトの設計
- [ ] few-shot examplesの追加（必要に応じて）
- [ ] 出力フォーマットの指定（JSON）
- [ ] 温度パラメータの調整

### キャッシング・最適化
- [ ] 同じURL要求時のキャッシング検討
- [ ] レスポンス時間の最適化
- [ ] ストリーミングレスポンスの検討

### エラーハンドリング
- [ ] API呼び出しエラーのハンドリング
- [ ] レート制限エラーの処理
- [ ] タイムアウトエラーの処理
- [ ] ユーザーフレンドリーなエラーメッセージ

---

## 🧪 Test Plan

1. **要約生成テスト**
   - 実際のニュース記事URLで要約生成
   - 3行で適切に要約されているか確認
   - 内容の正確性確認

2. **感想生成テスト**
   - 3パターンの感想が異なる視点か確認
   - SNS投稿に適した文字数か確認
   - 自然な日本語表現か確認

3. **エラーハンドリングテスト**
   - 無効なURLでのエラー表示
   - API制限超過時の挙動
   - タイムアウト時の挙動

4. **パフォーマンステスト**
   - レスポンス時間測定（目標: 10秒以内）
   - 複数リクエストの並行処理

---

## 📌 Acceptance Criteria

- [ ] 記事URLから正確にコンテンツを取得できる
- [ ] 要約が3行で適切に生成される
- [ ] 感想コメント3パターンが異なる視点で生成される
- [ ] エラーが適切にハンドリングされる
- [ ] API呼び出しが安全に実装されている（APIキーの露出なし）
- [ ] localhost で実際の記事URLを使って動作確認済み
- [ ] レスポンス時間が許容範囲内（10秒以内）
- [ ] リントエラーがゼロ
- [ ] 型エラーがゼロ

---

## 📎 Related

- **Implementation Guide**: [docs/implementation/03-ai-integration.md](../../implementation/03-ai-integration.md)
- **API Specifications**: [docs/idea/03-api-specifications.md](../../idea/03-api-specifications.md)
- **Previous Phase**: [phase-02-ui-implementation.md](./phase-02-ui-implementation.md)
- **Next Phase**: [phase-04-database-integration.md](./phase-04-database-integration.md)

---

## 💭 Memo

### プロンプト設計メモ
<!-- 効果的だったプロンプトの記録 -->

### API制限・コスト
<!-- API使用量、コストの記録 -->

### 完了時のGitコミットハッシュ
a38ec45

### 実装詳細
- 記事スクレイパー: Cheerioを使用してHTML解析、メタデータ抽出
- OpenAI API: GPT-4モデルで要約・感想生成、JSON形式レスポンス
- エラーハンドリング: 記事取得、パース、API呼び出しの各段階で適切なエラー処理
- 品質: TypeScript/ESLintエラーゼロ

---

**Created**: 2025-10-23
**Last Updated**: 2025-10-24
