// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Summary {
  id             String    @id @default(cuid())
  url            String
  title          String
  description    String?
  content        String    @db.Text
  author         String?
  publishedAt    DateTime?

  summaryLines   String[]
  summaryText    String    @db.Text

  tokensUsed     Int
  processingTime Int

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  comments       Comment[]

  @@index([url])
  @@index([createdAt])
}

model Comment {
  id         String   @id @default(cuid())
  summaryId  String
  text       String   @db.Text
  tone       String
  length     Int
  position   Int

  createdAt  DateTime @default(now())

  summary    Summary  @relation(fields: [summaryId], references: [id], onDelete: Cascade)

  @@index([summaryId])
  @@index([createdAt])
}

model Analytics {
  id                String   @id @default(cuid())
  date              DateTime @unique @db.Date
  totalSummaries    Int      @default(0)
  totalComments     Int      @default(0)
  totalTokens       Int      @default(0)
  avgProcessingTime Float    @default(0)
  uniqueUrls        Int      @default(0)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([date])
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([email])
}
